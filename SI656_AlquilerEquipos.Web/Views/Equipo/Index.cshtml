@model SI656_AlquilerEquipos.Web.ViewModel.Equipo.IndexViewModel

@{
    ViewBag.Title = "Index";
}



@*<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">*@


<div class="container-fluid">

    <p class="mb-4"></p>
    <!-- Page Heading -->
    <h1 class="h3 mb-2 text-gray-900"><strong>Equipos</strong></h1>
    <p class="mb-4"></p>
    <p>
        @Html.ActionLink("Nuevo Equipo", "Create", null, new { @class = "d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" })
    </p>
    <p class="mb-4"></p>

    <!-- DataTales Example -->
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary"></h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table id="example" class="" style="width:100%">
                    <thead>
                        <tr>
                            <th>Codigo</th>
                            <th>Nombre</th>
                            <th>Costo</th>
                            <th>Estado</th>
                            <th></th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>

</div>

@*<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>*@

<script type="text/javascript">

    $(document).ready(function () {

        var table = $('#example').DataTable({
            "data": @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.EquipmentList, Newtonsoft.Json.Formatting.Indented)),
            "language": {
                url: "http://cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"
            },
            "columns": [
                { data: 'codigo' },             //    0
                { data: 'nombre' },               //    1
                { data: 'costo' },          //    2
                //{ data: 'tipo_documento' },     //    3
                { data: 'estado_id' },                 //    4
                { data: 'id' },                 //    4
            ],
            "sScrollX": "100%",
            "sScrollXInner": "100%",
            "columnDefs": [
                {
                    "targets": [0, 1, 2, 3, 4],
                    "class": "text-center"
                },
                {
                    "orderable": false,
                    //"width": "12%",
                    "targets": [4],
                    "render": function (data, type, row, meta) {
                        let uriEquipmentEdit = '@Url.Action("Edit","Equipo" )' + '?id=' + data;
                        @*let uriClientDetail = '@Url.Action("Detail","Cliente")' + '?id=' + data;*@
                        let content = "" +
                            "<div class='btn-group'>" +
                            "<button type='button'class='btn btn-sm btn-light dropdown-toggle' data-toggle='dropdown' aria-expanded='false'> Opciones <i class='mdi mdi-chevron-dow'></i></button>" +
                            "<div class='dropdown-menu'>" +
                            "<a class='dropdown-item' href='" + uriEquipmentEdit  + "'  data-action='reject'><i class='mdi mdi-pen '></i></a>";
                            "<a class='dropdown-item btn-delete-client' data-client='" + data + "' href='#'><i class='mdi mdi-trash-can' style='margin-left:3px;'></i></a>" +
                            "</div>" +
                            "</div>";
                        return content;
                    }
                }
            ],
            "initComplete": function (settings, json) {
                actionButton();
            }
        });

        function actionButton() {
            //  Delete Equipment
            $('.btn-delete-client').click(function () {
                var driverId = $(this).attr('data-client');
                swal({
                    title: "Eliminar equipo",
                    text: '¿Está seguro que deseas eliminar este equipo?',
                    type: 'warning',
                    showCancelButton: true,
                    cancelButtonClass: 'btn-danger waves-effect waves-light',
                    cancelButtonText: 'Cancelar',
                    confirmButtonClass: 'btn-info waves-effect waves-light',
                    confirmButtonText: 'Aceptar',
                    allowOutsideClick: false
                }).then(function (result) {
                    if (result.value) {
                        swal({
                            title: 'Cargando...',
                            allowOutsideClick: false,
                            onOpen: () => { swal.showLoading() }
                        });

                        $.ajax({
                            url: '@Url.Action("Delete", "Equipo")',
                            type: 'POST',
                            data: { id: id}
                        }).done(function (data) {
                            if (data.isOk) {
                                swal({
                                    title: 'Éxito!',
                                    text: 'Equipo eliminado exitosamente.',
                                    type: 'success',
                                    timer: 1500,
                                    showConfirmButton: false
                                }).then(() => {
                                    location.reload();
                                });
                            } else {
                                swal({
                                    title: 'Info.',
                                    text: "Ha ocurrido un problema, porfavor intentelo mas tarde",
                                    type: 'info',
                                    timer: 1500,
                                    showConfirmButton: false
                                });
                                console.log(data.message);
                            }
                        });
                    }
                });
            });
        }
    }
</script>